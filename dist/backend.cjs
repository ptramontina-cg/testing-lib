"use strict";var k=Object.create;var u=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var E=(a,e)=>{for(var t in e)u(a,t,{get:e[t],enumerable:!0})},h=(a,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of x(e))!I.call(a,i)&&i!==t&&u(a,i,{get:()=>e[i],enumerable:!(o=M(e,i))||o.enumerable});return a};var y=(a,e,t)=>(t=a!=null?k(F(a)):{},h(e||!a||!a.__esModule?u(t,"default",{value:a,enumerable:!0}):t,a)),P=a=>h(u({},"__esModule",{value:!0}),a);var B={};E(B,{CreativeValidator:()=>g});module.exports=P(B);var p=class{constructor(e){this.file=e}async validate(){return console.log("backend validate image",this.file),!0}};var f=class{constructor(e){this.url=e}async validate(){return console.log("backend validate vast",this.url),!0}};var w=y(require("fluent-ffmpeg"),1),V=y(require("stream-buffers"),1),n=require("fs"),d=y(require("path"),1),v=class{constructor(){}getResolutionQuality(e,t){return e>=3840&&t>=2160?"4K":e>=2048&&t>=1080?"2K":e>=1920&&t>=1080?"Full HD":e>=1280&&t>=720?"HD":"SD"}test(){console.log("test from here"),console.log(n.promises)}async generateThumbnail(e){return await new Promise(async(t,o)=>{let i=d.default.join(__dirname,"tmp"),s=d.default.join(i,`temp_${Date.now()}`),l=d.default.join(i,`screenshot_${Date.now()}.png`);await n.promises.mkdir(i,{recursive:!0}),await n.promises.writeFile(s,e.buffer),(0,w.default)(s).on("error",async r=>{console.error("Error generating screenshot:",r),o(r)}).on("end",async()=>{try{let r=await n.promises.readFile(l);await n.promises.unlink(s).catch(()=>{}),await n.promises.unlink(l).catch(()=>{}),t(r)}catch(r){o(r)}}).screenshots({timestamps:["50%"],filename:d.default.basename(l),folder:i})})}async analyzeMediaBuffer(e){return new Promise((t,o)=>{let i=new V.default.ReadableStreamBuffer({frequency:10,chunkSize:2048});i.put(e.buffer),i.stop(),(0,w.default)(i).ffprobe(async(s,l)=>{if(s){o(s);return}let r=l.streams.find(m=>m.codec_type==="video"||m.codec_type==="image");if(!r){o(new Error("No video or image stream found"));return}let c={type:r.codec_type+"",resolution:{width:r.width,height:r.height},format:l.format.format_name+""};if(e.mimetype.startsWith("video")){c.durationInSeconds=r.duration?Math.floor(parseFloat(r.duration)):void 0,c.bitRate=Math.floor(parseInt(r.bit_rate+"")/1024),c.resolution.quality=this.getResolutionQuality(parseInt(r.width+""),parseInt(r.height+""));let m=await this.generateThumbnail(e);c.thumbnail=m}t(c)})})}};var b=class{constructor(e){this.file=e}async validate(){let t=await new v().analyzeMediaBuffer(this.file);return console.log("backend validate vast",t),!1}};var g=class{async validate(e,t){if(t instanceof String&&e!=="vast")throw new Error("Invalid type for backend validation.");switch(e){case"image":return await this.validateImage(t);case"video":return await this.validateVideo(t);case"vast":return await this.validateVast(t)}}async validateVideo(e){return await new b(e).validate()}async validateImage(e){return await new p(e).validate()}async validateVast(e){return await new f(e).validate()}};0&&(module.exports={CreativeValidator});
