"use strict";var k=Object.create;var u=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,I=Object.prototype.hasOwnProperty;var E=(t,e)=>{for(var a in e)u(t,a,{get:e[a],enumerable:!0})},h=(t,e,a,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of x(e))!I.call(t,o)&&o!==a&&u(t,o,{get:()=>e[o],enumerable:!(i=M(e,o))||i.enumerable});return t};var y=(t,e,a)=>(a=t!=null?k(F(t)):{},h(e||!t||!t.__esModule?u(a,"default",{value:t,enumerable:!0}):a,t)),P=t=>h(u({},"__esModule",{value:!0}),t);var B={};E(B,{CreativeValidator:()=>v});module.exports=P(B);var p=class{async validate(e){return console.log("backend validate image",e),!0}};var f=class{async validate(e){return console.log("backend validate vast",e),!0}};var w=y(require("fluent-ffmpeg"),1),V=y(require("stream-buffers"),1),n=require("fs"),m=y(require("path"),1),b=class{constructor(){}getResolutionQuality(e,a){return e>=3840&&a>=2160?"4K":e>=2048&&a>=1080?"2K":e>=1920&&a>=1080?"Full HD":e>=1280&&a>=720?"HD":"SD"}test(){console.log("test from here"),console.log(n.promises)}async generateThumbnail(e){return await new Promise(async(a,i)=>{let o=m.default.join(__dirname,"tmp"),s=m.default.join(o,`temp_${Date.now()}`),l=m.default.join(o,`screenshot_${Date.now()}.png`);await n.promises.mkdir(o,{recursive:!0}),await n.promises.writeFile(s,e.buffer),(0,w.default)(s).on("error",async r=>{console.error("Error generating screenshot:",r),i(r)}).on("end",async()=>{try{let r=await n.promises.readFile(l);await n.promises.unlink(s).catch(()=>{}),await n.promises.unlink(l).catch(()=>{}),a(r)}catch(r){i(r)}}).screenshots({timestamps:["50%"],filename:m.default.basename(l),folder:o})})}async analyzeMediaBuffer(e){return new Promise((a,i)=>{let o=new V.default.ReadableStreamBuffer({frequency:10,chunkSize:2048});o.put(e.buffer),o.stop(),(0,w.default)(o).ffprobe(async(s,l)=>{if(s){i(s);return}let r=l.streams.find(c=>c.codec_type==="video"||c.codec_type==="image");if(!r){i(new Error("No video or image stream found"));return}let d={type:r.codec_type+"",resolution:{width:r.width,height:r.height},format:l.format.format_name+""};if(e.mimetype.startsWith("video")){d.durationInSeconds=r.duration?Math.floor(parseFloat(r.duration)):void 0,d.bitRate=Math.floor(parseInt(r.bit_rate+"")/1024),d.resolution.quality=this.getResolutionQuality(parseInt(r.width+""),parseInt(r.height+""));let c=await this.generateThumbnail(e);d.thumbnail=c}a(d)})})}};var g=class{async validate(e){let i=await new b().analyzeMediaBuffer(e);return console.log("backend validate vast",i),!1}};var v=class{async validate(e,a){if(a instanceof String&&e!=="vast")throw new Error("Invalid type for backend validation.");switch(e){case"image":return await this.validateImage(a);case"video":return await this.validateVideo(a);case"vast":return await this.validateVast(a)}}async validateVideo(e){return await new g().validate(e)}async validateImage(e){return await new p().validate(e)}async validateVast(e){return await new f().validate(e)}};0&&(module.exports={CreativeValidator});
