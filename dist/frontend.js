var c=["JPEG","JPG","PNG","GIF"];var r=class extends Error{code;constructor(e,t){super(e),this.code=t,this.name="ValidationError"}get errorCode(){return this.code}};function d(n){return(n.includes("/")?n.split("/")[1]:n).toUpperCase()}var I=class{async validate(e){if(!e.type.includes("image/"))throw new r("Invalid File Input: File is not an image",103);let t=[this.validateSize(e),await this.validateResolution(e),this.validateType(e)].filter(i=>i);if(t.length)throw new r(`Invalid Image: ${t.join(", ")}`,100);return!0}validateSize(e){return e.size>1e8?`Invalid size. Maximum allowed is: ${1e8/1e6} MB.`:!1}async validateResolution(e){let t=await this.getImageFromFile(e);return t.width>2e3||t.width<50||t.height>2e3||t.height<50?`Invalid resolution - Min: ${50}x${50} - Max: ${2e3}x${2e3}`:!1}validateType(e){return c.includes(d(e.type))?!1:`Invalid format - Only the following are allowed: ${c.join(", ")}`}async getImageFromFile(e){return new Promise((t,i)=>{e.arrayBuffer().then(o=>{let l=new Blob([o],{type:e.type}),s=URL.createObjectURL(l),a=new Image;a.src=s,a.onload=()=>t(a),a.onerror=i})})}};import T from"axios";var m=class{async validate(e){return this.validateUrl(e),await this.validateXml(e),!0}validateUrl(e){try{return new URL(e),!0}catch{throw new r("Invalid Vast: Current input is not an url",102)}}async validateXml(e){if(!(await T.get(e)).data.includes("<?xml"))throw new r("Invalid Vast: Return from url is not XML",102);return!0}};var w=[15,30,60],p={2160:3e4,1280:13e3,1080:12e3,720:8e3,432:2e3},A=["WEBM","OGG","MP4"],V=1e8;var u=class{async validate(e){if(!e.type.includes("video/"))throw new r("Invalid File Input: File is not a video",103);let t=await this.getVideoFromFile(e),i=[this.validateSize(e)];if(this.isVideoSupported(e)){let o=await this.getVideoFromFile(e);i.push(this.validateBitRate(e.size,o.duration,o.videoHeight),this.validateResolution(o.height),this.validateDuration(o.duration))}if(i=i.filter(o=>o),i.length)throw new r(`Invalid Video: ${i.join(", ")}`,101);return!0}validateSize(e){return e.size>V?`Invalid size - Maximum allowed is: ${V/1e6} MB.`:!1}validateBitRate(e,t,i){if(!(i in p))return"Invalid bitrate - Didn't match with resolution.";t=Math.round(t);let s=e*8/1e3/t,a=p[i];return s>=a?!1:`Video has a bitrate of ${s} kbps which is incorrect for ${i}p resolution - Please the following or above: ${a}`}validateResolution(e){return e in p?"Resolution not supported - Please use 2160p, 1280p, 1080p, 720p or 432p.":!1}validateDuration(e){return e=Math.round(e),w.includes(e)?!1:`The uploaded video has duration ${e}sec which is not supported - Please use one of the following durations: 15s, 30s, 60s`}isVideoSupported(e){return A.includes(d(e.type))}async getVideoFromFile(e){return new Promise((t,i)=>{e.arrayBuffer().then(o=>{let l=new Blob([o]),s=URL.createObjectURL(l),a=document.createElement("video");a.onloadedmetadata=()=>t(a),a.src=s})})}};var E=class{async validate(e,t){if(t instanceof String&&e!=="vast")throw new r("Invalid File Input: String is only allowed for VAST.",103);switch(e){case"image":return await this.validateImage(t);case"video":return await this.validateVideo(t);case"vast":return await this.validateVast(t)}}async validateVideo(e){return await new u().validate(e)}async validateImage(e){return await new I().validate(e)}async validateVast(e){return await new m().validate(e)}};export{E as CreativeValidator};
